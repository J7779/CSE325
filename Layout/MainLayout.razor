@inherits LayoutComponentBase
@inject AuthService AuthService
@inject NavigationManager Navigation

<div class="app-container">
    <nav class="top-nav">
        <div class="nav-content">
            <a href="" class="logo">
                <span class="logo-icon">🍳</span>
                <span class="logo-text">FlavorShare</span>
            </a>

            <div class="nav-links">
                <NavLink href="" class="nav-link" Match="NavLinkMatch.All">
                    <span class="nav-icon">🏠</span>
                    Home
                </NavLink>
                <NavLink href="recipes" class="nav-link">
                    <span class="nav-icon">📖</span>
                    Recipes
                </NavLink>
                <NavLink href="categories" class="nav-link">
                    <span class="nav-icon">🏷️</span>
                    Categories
                </NavLink>
                @if (AuthService.IsAuthenticated)
                {
                    <NavLink href="my-recipes" class="nav-link">
                        <span class="nav-icon">👨‍🍳</span>
                        My Recipes
                    </NavLink>
                }
            </div>

            <div class="nav-actions">
                @if (AuthService.IsAuthenticated)
                {
                    <NavLink href="recipe/new" class="btn-primary">
                        <span>➕</span> Add Recipe
                    </NavLink>
                    <div class="user-menu">
                        <button class="user-avatar" @onclick="ToggleUserMenu">
                            @(AuthService.CurrentUser?.DisplayName?[0] ?? 'U')
                        </button>
                        @if (_showUserMenu)
                        {
                            <div class="dropdown-menu">
                                <div class="dropdown-header">
                                    <strong>@AuthService.CurrentUser?.DisplayName</strong>
                                    <small>@AuthService.CurrentUser?.Email</small>
                                </div>
                                <hr />
                                <a href="profile" class="dropdown-item">👤 Profile</a>
                                <a href="my-recipes" class="dropdown-item">📝 My Recipes</a>
                                <hr />
                                <button class="dropdown-item logout" @onclick="HandleLogout">🚪 Logout</button>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <NavLink href="login" class="btn-secondary">Login</NavLink>
                    <NavLink href="register" class="btn-primary">Sign Up</NavLink>
                }
            </div>

            <button class="mobile-menu-btn" @onclick="ToggleMobileMenu">
                @(_showMobileMenu ? "✕" : "☰")
            </button>
        </div>

        @if (_showMobileMenu)
        {
            <div class="mobile-nav">
                <NavLink href="" class="mobile-nav-link" @onclick="CloseMobileMenu">🏠 Home</NavLink>
                <NavLink href="recipes" class="mobile-nav-link" @onclick="CloseMobileMenu">📖 Recipes</NavLink>
                <NavLink href="categories" class="mobile-nav-link" @onclick="CloseMobileMenu">🏷️ Categories</NavLink>
                @if (AuthService.IsAuthenticated)
                {
                    <NavLink href="my-recipes" class="mobile-nav-link" @onclick="CloseMobileMenu">👨‍🍳 My Recipes</NavLink>
                    <NavLink href="recipe/new" class="mobile-nav-link" @onclick="CloseMobileMenu">➕ Add Recipe</NavLink>
                    <NavLink href="profile" class="mobile-nav-link" @onclick="CloseMobileMenu">👤 Profile</NavLink>
                    <button class="mobile-nav-link logout" @onclick="HandleLogout">🚪 Logout</button>
                }
                else
                {
                    <NavLink href="login" class="mobile-nav-link" @onclick="CloseMobileMenu">🔐 Login</NavLink>
                    <NavLink href="register" class="mobile-nav-link" @onclick="CloseMobileMenu">✨ Sign Up</NavLink>
                }
            </div>
        }
    </nav>

    <main class="main-content">
        @Body
    </main>

    <footer class="app-footer">
        <div class="footer-content">
            <div class="footer-brand">
                <span class="logo-icon">🍳</span>
                <span>FlavorShare</span>
            </div>
            <p>Share your culinary creations with the world</p>
            <div class="footer-links">
                <a href="about">About</a>
                <a href="privacy">Privacy</a>
                <a href="terms">Terms</a>
            </div>
            <p class="copyright">© 2025 FlavorShare. Made with ❤️ for food lovers.</p>
        </div>
    </footer>
</div>

@code {
    private bool _showUserMenu = false;
    private bool _showMobileMenu = false;

    private void ToggleUserMenu()
    {
        _showUserMenu = !_showUserMenu;
    }

    private void ToggleMobileMenu()
    {
        _showMobileMenu = !_showMobileMenu;
    }

    private void CloseMobileMenu()
    {
        _showMobileMenu = false;
    }

    private async Task HandleLogout()
    {
        await AuthService.LogoutAsync();
        _showUserMenu = false;
        _showMobileMenu = false;
        Navigation.NavigateTo("", forceLoad: true);
    }
}
